<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Zona Tienda</title>
  <link rel="stylesheet" href="../assets/css/style.css">
  <!-- Scripts: utilidades -> servicios -> app -->
  <script defer src="../assets/js/utils.js"></script>
  <script defer src="../assets/js/services/StorageService.js"></script>
  <script defer src="../assets/js/services/ValidationService.js"></script>
  <script defer src="../assets/js/services/EventEmitter.js"></script>
  <script defer src="../assets/js/services/TransactionService.js"></script>
  <script defer src="../assets/js/authservice.js"></script>
  <script defer src="../assets/js/productService.js"></script>
  <script defer src="../assets/js/storeService.js"></script>
  <script defer src="../assets/js/app.js"></script>
  <!-- Supabase client (local) and initialization -->
  <script defer src="../assets/vendor/supabase.min.js"></script>
  <script defer src="../assets/js/supabaseClient.js"></script>
</head>
<body>
  <div class="tienda-layout">
    <!-- SIDEBAR IZQUIERDA: Perfil y acciones r√°pidas -->
    <aside class="tienda-sidebar">
      <!-- Encabezado -->
      <div class="tienda-header">
        <h1>Zona Tienda</h1>
      </div>

      <!-- Perfil operativo de la tienda -->
      <section id="tiendaPerfil" class="tienda-profile" aria-live="polite">
        <div style="display: flex; justify-content: space-between; align-items: flex-start; gap: 12px;">
          <h2 style="margin: 0;">Perfil</h2>
          <button id="btnEditarPerfil" type="button" class="btn-editar-perfil">‚úèÔ∏è</button>
        </div>
        <div class="tienda-profile-body">
          <p class="tienda-nombre">Cargando...</p>
          <p class="tienda-direccion"></p>
          <p class="tienda-telefono"></p>
          <p class="tienda-horario"></p>
          <p class="tienda-responsable"></p>
        </div>
      </section>

      <!-- Acciones r√°pidas -->
      <section class="tienda-actions">
        <h3>Acciones R√°pidas</h3>
        <form id="formTiendaSidebar" class="form-compacto">
          <label for="clienteSidebar">Email del cliente:</label>
          <input type="email" id="clienteSidebar" placeholder="ana@mail.com">
          <label for="puntosSidebar">Puntos:</label>
          <input type="number" id="puntosSidebar" placeholder="50" min="1">
          <button type="submit" class="btn-secondary">Agregar Puntos</button>
        </form>
        <p id="mensajeSidebar" class="mensaje-compacto"></p>
      </section>

      <!-- Bot√≥n de cierre sesi√≥n -->
      <button onclick="logout()" class="btn-logout">üö™ Cerrar sesi√≥n</button>
    </aside>

    <!-- MAIN: Contenido principal -->
    <main class="tienda-main">
      <!-- Formulario de producto -->
      <section class="tienda-section">
        <h2>üì¶ Agregar Producto</h2>
        <form id="formProducto" class="form-producto">
          <div class="form-row">
            <div class="form-col">
              <label for="nombreProd">Nombre del producto:</label>
              <input type="text" id="nombreProd" required>
            </div>
            <div class="form-col">
              <label for="costoProd">Costo en puntos:</label>
              <input type="number" id="costoProd" required min="1">
            </div>
          </div>

          <div class="form-row">
            <div class="form-col">
              <label for="precioDolarProd">Precio en d√≥lares:</label>
              <input type="number" id="precioDolarProd" step="0.01" min="0">
            </div>
            <div class="form-col">
              <label for="stockProd">Stock disponible:</label>
              <input type="number" id="stockProd" min="0" value="0">
            </div>
          </div>

          <div class="form-row">
            <div class="form-col">
              <label for="imagenProdFile">Imagen del producto:</label>
              <input type="file" id="imagenProdFile" accept="image/*">
              <div id="imagenProdPreview" style="margin-top:8px;"></div>
              <button type="button" id="imagenProdClear" class="btn-secondary" style="margin-top:6px; display:none;">Limpiar imagen</button>
            </div>
          </div>

          <div class="form-row">
            <div class="form-col" style="grid-column: 1 / -1;">
              <label for="descripcionProd">Descripci√≥n:</label>
              <textarea id="descripcionProd" rows="3" maxlength="200" placeholder="Describe brevemente el producto..."></textarea>
            </div>
          </div>

          <button type="submit" class="btn-primary">‚ûï Agregar Producto</button>
        </form>
      </section>

      <!-- Lista de productos -->
      <section class="tienda-section">
        <h2>üìã Mis Productos</h2>
        <div class="productos-tienda-list">
          <ul id="listaProductos"></ul>
        </div>
      </section>

      <!-- Historial de canjes de la tienda -->
      <section class="tienda-section">
        <div style="display:flex; justify-content:space-between; align-items:center; gap:12px;">
          <h2>üïò Historial de Canjes</h2>
          <div class="historial-controls" style="display:flex; gap:8px; align-items:center;">
            <input id="filtroBusqueda" type="search" placeholder="Buscar producto o cliente" style="padding:8px 10px; border-radius:6px; border:1px solid #d0d0d0;">
            <input id="filtroDesde" type="date" title="Desde" style="padding:8px 10px; border-radius:6px; border:1px solid #d0d0d0;">
            <input id="filtroHasta" type="date" title="Hasta" style="padding:8px 10px; border-radius:6px; border:1px solid #d0d0d0;">
            <button id="btnExportCSV" class="btn-secondary" type="button">Exportar CSV</button>
          </div>
        </div>
        <div class="historial-tienda-list">
          <ul id="historialCanjesTienda"></ul>
        </div>
      </section>
    </main>
  </div>

  <!-- Modal de edici√≥n de perfil -->
  <div id="modalEditarPerfil" class="modal" aria-hidden="true">
    <div class="modal-content">
      <button type="button" class="modal-close" aria-label="Cerrar">&times;</button>
      <div class="modal-header">
        <h2>Editar Perfil de la Tienda</h2>
      </div>
      <form id="formEditarPerfil" class="modal-body" style="display: block;">
        <label for="editNombreTienda">Nombre de la tienda:</label>
        <input type="text" id="editNombreTienda" required>
        
        <label for="editDireccionTienda">Direcci√≥n (si es f√≠sica):</label>
        <input type="text" id="editDireccionTienda">
        
        <label for="editTelefonoTienda">Datos de contacto:</label>
        <input type="text" id="editTelefonoTienda" required>
        
        <label for="editHorarioTienda">Horario de atenci√≥n:</label>
        <input type="text" id="editHorarioTienda">
        
        <label for="editResponsableTienda">Persona responsable:</label>
        <input type="text" id="editResponsableTienda">
      </form>
      <div class="modal-footer">
        <button type="button" class="btn-secondary" id="btnCancelarEdicion">Cancelar</button>
        <button type="button" class="btn-primary" id="btnGuardarEdicion">Guardar cambios</button>
      </div>
    </div>
  </div>

  <!-- Modal de edici√≥n/eliminaci√≥n de producto -->
  <div id="modalProductoTienda" class="modal" aria-hidden="true">
    <div class="modal-content">
      <button type="button" class="modal-close" aria-label="Cerrar">&times;</button>
      <div class="modal-header">
        <h2>Editar Producto</h2>
      </div>
      <div class="modal-body" style="display: block; grid-template-columns: 1fr;">
        <div id="productoTiendaInfo" style="display: flex; flex-direction: column; gap: 12px;">
          <div>
            <strong>Nombre:</strong>
            <input type="text" id="editProductoNombre" style="width: 100%; margin-top: 4px;">
          </div>
          <div>
            <strong>Descripci√≥n:</strong>
            <textarea id="editProductoDescripcion" rows="3" style="width: 100%; margin-top: 4px;"></textarea>
          </div>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
            <div>
              <strong>Costo (puntos):</strong>
              <input type="number" id="editProductoCosto" min="1" style="width: 100%; margin-top: 4px;">
            </div>
            <div>
              <strong>Stock:</strong>
              <input type="number" id="editProductoStock" min="0" style="width: 100%; margin-top: 4px;">
            </div>
          </div>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
            <div>
              <strong>Precio ($):</strong>
              <input type="number" id="editProductoPrecio" step="0.01" min="0" style="width: 100%; margin-top: 4px;">
            </div>
          <div>
            <strong>Imagen del producto:</strong>
            <input type="file" id="editProductoImagenFile" accept="image/*" style="margin-top:6px;">
            <div id="editProductoImagenPreview" style="margin-top:8px;"></div>
            <button type="button" id="editProductoImagenClear" class="btn-secondary" style="margin-top:6px; display:none;">Limpiar imagen</button>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn-secondary" id="btnCancelarProducto">Cancelar</button>
        <button type="button" class="btn-secondary" id="btnEliminarProducto" style="background: #ef4444; color: white; border: none;">üóëÔ∏è Eliminar</button>
        <button type="button" class="btn-primary" id="btnGuardarProducto">Guardar cambios</button>
      </div>
    </div>
  </div>
</body>
</html>
